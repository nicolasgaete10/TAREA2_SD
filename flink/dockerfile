FROM flink:1.14.3-scala_2.12-java11

USER root

RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        python3 \
        python3-pip \
        cmake \
        pkg-config \
        build-essential \
        ca-certificates \
        curl \
    && rm -rf /var/lib/apt/lists/*
    

WORKDIR /opt/flink/usrlib

RUN pip3 install --no-cache-dir --upgrade pip setuptools wheel || true


RUN curl -L -o /opt/flink/lib/flink-connector-kafka.jar \
    https://repo.maven.apache.org/maven2/org/apache/flink/flink-connector-kafka_2.12/1.14.3/flink-connector-kafka_2.12-1.14.3.jar


COPY flink.py .

USER flink